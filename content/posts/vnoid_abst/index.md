---
title: "004 - vnoidパッケージの概要"
date: 2023-06-22
categories: ["vnoidベースの開発"]
menu: main
---

---

## 今回の内容

本チャレンジでは、初心者の方でも簡単に人形ロボットの運動計画ができるように  
vnoidというサンプルパッケージが用意されております。

今回はこちらのvnoidパッケージの概要について解説します。

---

## vnoidパッケージとは
vnoidパッケージとは、  
人型ロボットの基本的な機能を理解するためのサンプルコード集です。

各機能はC/C++言語により、100行程度で記述されております。

コードの可読性が高く、自らの手で拡張しやすいサンプルだと思います。

環境構築の記事でも解説したように、  
vnoidで記述された内容にしたがって、  
Choreonoid上で人型ロボットの動作シミュレーションが可能です。

---

## vnoidパッケージの内容

vnoidパッケージには、以下の機能が含まれています。

・順運動学(fksolver)  
・逆運動学(iksolver)  
・歩行パターン生成(footstep_planner, stepping_controller)  
・バランス制御(stabilizer)

これらの機能を使って人型ロボットの運動制御ができます。

---

## 人型ロボットの運動計画の大まかな流れ

以下がvnoidにおける人型ロボットの運動計画の流れです。

1. Robot::Sense  
ロボットの基準座標を置くベースリンクの位置・姿勢を計測する。  
各関節の回転変位を計測する。  
足部に取り付けた6軸力センサにより、  
足部に作用する床反力と床反モーメントを計測する。

1. fk_solver  
順運動学を解き、各リンク座標の位置・姿勢を求める。  
各リンクの重さと重心位置の情報を用いてロボットの重心位置を計算する。

1. footstep_planner  
ジョイスティックの入力に基づいて数歩先までの足の着地位置・姿勢を決定する。  
着地位置・姿勢に基づき、各歩行ステップの目標DCMを計算する。  
(※ DCMについては別の記事で解説します。)

1. stepping_controller  
各ステップ時刻における支持足、振り足の位置・姿勢を更新する。  
振り足の位置に関しては、事前にDCMに基づいて着地位置の修正をしておき、  
その結果を反映できるサイクロイド曲線軌道として与える。

1. stabilizer  
ベースリンクの傾きを直立状態に戻せるようなZMPを計算する。
このZMPは支持多角形(SP)を出る場合があるので、SP内に投影する。
SP内に投影したZMPを修正ZMPとして、辻褄が合うようにDCM、重心位置を修正する。  
修正ZMPに基づいて目標床反力を計算する。  
計測床反力が目標床反力に近づくように支持足の位置・姿勢を修正する。

1. ik_solver  
手足の位置・姿勢情報を用いて逆運動学を解き、各関節の目標回転変位を計算する。  
(※ なお、現状手の位置・姿勢は常にベースリンクの真横に固定されている。)

1. Robot::Actuate  
関節の目標回転変位を実現するのに必要なトルクを計算し、関節に出力する。

---

## まとめ・次回予告

今回はvnoidパッケージの概要について説明しました。

次回：人型ロボットの運動学
